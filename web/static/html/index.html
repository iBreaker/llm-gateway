<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Gateway - Web Management</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 data-i18n="header.title">LLM Gateway</h1>
            <div class="header-info">
                <span data-i18n="header.subtitle">Management Console</span>
                <span>â€¢</span>
                <a href="/static/html/settings.html" class="btn btn-secondary btn-sm" data-i18n="settings.title">Settings</a>
            </div>
        </div>
    </header>

    <nav class="nav">
        <div class="container">
            <button class="nav-btn active" data-tab="dashboard" data-i18n="nav.dashboard">Dashboard</button>
            <button class="nav-btn" data-tab="upstream" data-i18n="nav.upstream">Upstream Accounts</button>
            <button class="nav-btn" data-tab="apikeys" data-i18n="nav.apikeys">API Keys</button>
            <button class="nav-btn" data-tab="config" data-i18n="nav.config">Configuration</button>
            <button class="nav-btn" data-tab="model-routes" data-i18n="nav.model_routes">Model Routes</button>
        </div>
    </nav>

    <main class="main">
        <div class="container">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="page-header">
                    <div>
                        <h1 class="page-title" data-i18n="dashboard.title">System Dashboard</h1>
                        <p class="page-subtitle" data-i18n="dashboard.subtitle">Monitor system health and performance metrics</p>
                    </div>
                </div>
                
                <div class="cards">
                    <div class="card">
                        <h3 data-i18n="dashboard.system_status">System Status</h3>
                        <div class="status-indicator">
                            <span class="status-dot" id="system-status"></span>
                            <span id="system-status-text" data-i18n="dashboard.loading">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 data-i18n="dashboard.upstream_accounts">Upstream Accounts</h3>
                        <div class="metric">
                            <span class="metric-value" id="upstream-count">-</span>
                            <span class="metric-label" data-i18n="dashboard.total_accounts">Total Accounts</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 data-i18n="dashboard.api_keys">API Keys</h3>
                        <div class="metric">
                            <span class="metric-value" id="apikey-count">-</span>
                            <span class="metric-label" data-i18n="dashboard.active_keys">Active Keys</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 data-i18n="dashboard.server_info">Server Info</h3>
                        <div class="server-info">
                            <div><span data-i18n="config.host">Host:</span> <span id="server-host">-</span></div>
                            <div><span data-i18n="config.port">Port:</span> <span id="server-port">-</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upstream Accounts Tab -->
            <div id="upstream" class="tab-content">
                <div class="page-header">
                    <div>
                        <h1 class="page-title" data-i18n="upstream.title">Upstream Accounts</h1>
                        <p class="page-subtitle" data-i18n="upstream.subtitle">Manage AI provider connections and configurations</p>
                    </div>
                    <button class="btn btn-primary" onclick="showAddUpstreamModal()" data-i18n="upstream.add_account">+ Add Account</button>
                </div>
                
                <div class="actions">
                    <button class="btn btn-secondary" onclick="refreshUpstreamAccounts()" data-i18n="upstream.refresh">Refresh</button>
                </div>
                
                <!-- Statistics Cards -->
                <div class="cards" id="upstream-stats" style="display: none;">
                    <div class="card stat-card stat-total">
                        <h3 data-i18n="stats.total">Total</h3>
                        <div class="metric">
                            <span class="metric-value" id="upstream-stats-total">0</span>
                            <span class="metric-label" data-i18n="stats.accounts">Accounts</span>
                        </div>
                    </div>
                    <div class="card stat-card stat-active">
                        <h3 data-i18n="stats.active">Active</h3>
                        <div class="metric">
                            <span class="metric-value" id="upstream-stats-active">0</span>
                            <span class="metric-label" data-i18n="stats.active">Active</span>
                        </div>
                    </div>
                    <div class="card stat-card stat-healthy">
                        <h3 data-i18n="stats.healthy">Healthy</h3>
                        <div class="metric">
                            <span class="metric-value" id="upstream-stats-healthy">0</span>
                            <span class="metric-label" data-i18n="stats.healthy">Healthy</span>
                        </div>
                    </div>
                    <div class="card stat-card stat-providers">
                        <h3 data-i18n="stats.providers">Providers</h3>
                        <div class="metric providers-list">
                            <div id="upstream-stats-providers">-</div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="table" id="upstream-table">
                        <thead>
                            <tr>
                                <th data-i18n="upstream.table.name">Name</th>
                                <th data-i18n="upstream.table.provider">Provider</th>
                                <th data-i18n="upstream.table.type">Type</th>
                                <th data-i18n="upstream.table.status">Status</th>
                                <th data-i18n="upstream.table.health">Health</th>
                                <th data-i18n="upstream.table.usage">Usage</th>
                                <th data-i18n="upstream.table.actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="upstream-tbody">
                            <tr>
                                <td colspan="7" class="loading" data-i18n="upstream.loading">Loading upstream accounts...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- API Keys Tab -->
            <div id="apikeys" class="tab-content">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">API Keys</h1>
                        <p class="page-subtitle" data-i18n="apikeys.subtitle">Manage gateway authentication tokens and access controls</p>
                    </div>
                    <button class="btn btn-primary" onclick="showAddApiKeyModal()" data-i18n="apikeys.generate_key">+ Generate Key</button>
                </div>
                
                <div class="actions">
                    <button class="btn btn-secondary" onclick="refreshApiKeys()" data-i18n="apikeys.refresh">Refresh</button>
                </div>
                
                <!-- Statistics Cards -->
                <div class="cards" id="apikey-stats" style="display: none;">
                    <div class="card stat-card stat-total">
                        <h3 data-i18n="stats.total">Total</h3>
                        <div class="metric">
                            <span class="metric-value" id="apikey-stats-total">0</span>
                            <span class="metric-label" data-i18n="stats.keys">Keys</span>
                        </div>
                    </div>
                    <div class="card stat-card stat-active">
                        <h3 data-i18n="stats.active">Active</h3>
                        <div class="metric">
                            <span class="metric-value" id="apikey-stats-active">0</span>
                            <span class="metric-label" data-i18n="stats.active">Active</span>
                        </div>
                    </div>
                    <div class="card stat-card stat-requests">
                        <h3 data-i18n="stats.total_requests">Total Requests</h3>
                        <div class="metric">
                            <span class="metric-value" id="apikey-stats-requests">0</span>
                            <span class="metric-label" data-i18n="stats.requests">Requests</span>
                        </div>
                    </div>
                    <div class="card stat-card stat-recent">
                        <h3 data-i18n="stats.recent_usage">Recent Usage</h3>
                        <div class="metric">
                            <span class="metric-value" id="apikey-stats-recent">0</span>
                            <span class="metric-label" data-i18n="stats.last_24h">Last 24h</span>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="table" id="apikey-table">
                        <thead>
                            <tr>
                                <th data-i18n="apikeys.table.name">Name</th>
                                <th data-i18n="apikeys.table.permissions">Permissions</th>
                                <th data-i18n="apikeys.table.status">Status</th>
                                <th data-i18n="apikeys.table.usage">Usage</th>
                                <th data-i18n="apikeys.table.created">Created</th>
                                <th data-i18n="apikeys.table.actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="apikey-tbody">
                            <tr>
                                <td colspan="6" class="loading" data-i18n="apikeys.loading">Loading API keys...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Configuration Tab -->
            <div id="config" class="tab-content">
                <div class="page-header">
                    <div>
                        <h1 class="page-title" data-i18n="config.title">System Configuration</h1>
                        <p class="page-subtitle" data-i18n="config.subtitle">View current system settings and operational parameters</p>
                    </div>
                </div>
                
                <div class="config-section">
                    <h3 data-i18n="config.server">Server Configuration</h3>
                    <div class="config-item">
                        <label data-i18n="config.host">Host:</label>
                        <span id="config-host">-</span>
                    </div>
                    <div class="config-item">
                        <label data-i18n="config.port">Port:</label>
                        <span id="config-port">-</span>
                    </div>
                    <div class="config-item">
                        <label data-i18n="config.timeout">Timeout:</label>
                        <span id="config-timeout">-</span>
                    </div>
                </div>
                
                <div class="config-section">
                    <h3 data-i18n="config.proxy">Proxy Configuration</h3>
                    <div class="config-item">
                        <label data-i18n="config.request_timeout">Request Timeout:</label>
                        <span id="config-request-timeout">-</span>
                    </div>
                    <div class="config-item">
                        <label data-i18n="config.stream_timeout">Stream Timeout:</label>
                        <span id="config-stream-timeout">-</span>
                    </div>
                    <div class="config-item">
                        <label data-i18n="config.connect_timeout">Connect Timeout:</label>
                        <span id="config-connect-timeout">-</span>
                    </div>
                    <div class="config-item">
                        <label data-i18n="config.response_timeout">Response Timeout:</label>
                        <span id="config-response-timeout">-</span>
                    </div>
                </div>
                
                <div class="config-section">
                    <h3 data-i18n="config.logging">Logging</h3>
                    <div class="config-item">
                        <label data-i18n="config.level">Level:</label>
                        <span id="config-log-level">-</span>
                    </div>
                    <div class="config-item">
                        <label data-i18n="config.format">Format:</label>
                        <span id="config-log-format">-</span>
                    </div>
                </div>
            </div>

            <!-- Global Model Routes Tab -->
            <div id="model-routes" class="tab-content">
                <div class="page-header">
                    <div>
                        <h1 class="page-title" data-i18n="global_routes.title">Global Model Routes</h1>
                        <p class="page-subtitle" data-i18n="global_routes.subtitle">Configure global model routing rules and fallback behaviors</p>
                    </div>
                    <button class="btn btn-primary" onclick="app.showAddGlobalRouteForm()" data-i18n="global_routes.add_route">+ Add Route</button>
                </div>

                <div class="actions">
                    <button class="btn btn-secondary" onclick="app.refreshGlobalRoutes()" data-i18n="global_routes.refresh">Refresh</button>
                </div>

                <!-- Statistics Cards -->
                <div class="cards" id="global-routes-stats" style="display: none;">
                    <div class="card stat-card stat-total">
                        <h3 data-i18n="stats.total">Total</h3>
                        <div class="metric">
                            <span class="metric-value" id="global-routes-stats-total">0</span>
                            <span class="metric-label" data-i18n="stats.routes">Routes</span>
                        </div>
                    </div>
                    <div class="card stat-card stat-active">
                        <h3 data-i18n="stats.active">Active</h3>
                        <div class="metric">
                            <span class="metric-value" id="global-routes-stats-active">0</span>
                            <span class="metric-label" data-i18n="stats.active">Active</span>
                        </div>
                    </div>
                    <div class="card stat-card stat-providers">
                        <h3 data-i18n="stats.providers">Providers</h3>
                        <div class="metric providers-list">
                            <div id="global-routes-stats-providers">-</div>
                        </div>
                    </div>
                    <div class="card stat-card stat-recent">
                        <h3 data-i18n="stats.recent_usage">Recent Usage</h3>
                        <div class="metric">
                            <span class="metric-value" id="global-routes-stats-recent">0</span>
                            <span class="metric-label" data-i18n="stats.last_24h">Last 24h</span>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <table class="table" id="global-routes-table">
                        <thead>
                            <tr>
                                <th data-i18n="model_routes.source_model">Source Model</th>
                                <th data-i18n="model_routes.target_model">Target Model</th>
                                <th data-i18n="model_routes.target_provider">Target Provider</th>
                                <th data-i18n="model_routes.priority">Priority</th>
                                <th data-i18n="common.status">Status</th>
                                <th data-i18n="apikeys.table.actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="global-routes-tbody">
                            <tr>
                                <td colspan="6" class="loading" data-i18n="global_routes.loading">Loading global routes...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Upstream Account Modal -->
    <div id="add-upstream-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('add-upstream-modal')">&times;</span>
            <h3 data-i18n="modal.add_upstream">Add Upstream Account</h3>
            <form id="add-upstream-form">
                <div class="form-group">
                    <label for="upstream-name" data-i18n="form.name">Name:</label>
                    <input type="text" id="upstream-name" required>
                </div>
                <div class="form-group">
                    <label for="upstream-provider" data-i18n="form.provider">Provider:</label>
                    <select id="upstream-provider" required>
                        <option value="anthropic">Anthropic</option>
                        <option value="openai">OpenAI</option>
                        <option value="google">Google</option>
                        <option value="azure">Azure</option>
                        <option value="qwen">Qwen</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="upstream-type" data-i18n="form.type">Type:</label>
                    <select id="upstream-type" required>
                        <option value="api-key">API Key</option>
                        <option value="oauth">OAuth</option>
                    </select>
                </div>
                <div class="form-group" id="api-key-group">
                    <label for="upstream-api-key" data-i18n="form.api_key">API Key:</label>
                    <input type="password" id="upstream-api-key" placeholder="sk-ant-... or sk-...">
                </div>
                <div class="form-group" id="oauth-info" style="display: none;">
                    <div class="alert alert-info">
                        <span data-i18n="form.oauth_info">OAuth accounts use predefined client credentials. Only Anthropic and Qwen providers support OAuth.</span>
                    </div>
                </div>
                <div class="form-group" id="base-url-group" style="display: none;">
                    <label for="upstream-base-url" data-i18n="form.base_url">Base URL (optional):</label>
                    <input type="url" id="upstream-base-url" data-i18n-placeholder="form.base_url_placeholder" placeholder="https://custom-api-endpoint.com">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-upstream-modal')" data-i18n="modal.cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="modal.add">Add Account</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add API Key Modal -->
    <div id="add-apikey-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('add-apikey-modal')">&times;</span>
            <h3 data-i18n="modal.generate_key">Generate API Key</h3>
            <form id="add-apikey-form">
                <div class="form-group">
                    <label for="apikey-name" data-i18n="form.name">Name:</label>
                    <input type="text" id="apikey-name" required>
                </div>
                <div class="form-group">
                    <label for="apikey-permissions" data-i18n="form.permissions">Permissions:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" value="read" checked> <span data-i18n="form.read">Read</span></label>
                        <label><input type="checkbox" value="write" checked> <span data-i18n="form.write">Write</span></label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-apikey-modal')" data-i18n="modal.cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="modal.generate">Generate Key</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Generated API Key Modal -->
    <div id="generated-key-modal" class="modal">
        <div class="modal-content">
            <h3 data-i18n="modal.key_generated">API Key Generated</h3>
            <div class="alert alert-warning">
                <span data-i18n="modal.warning">Important: This is the only time you'll see this key. Please copy and store it securely.</span>
            </div>
            <div class="generated-key">
                <code id="generated-key-value"></code>
                <button class="btn btn-copy" onclick="copyToClipboard('generated-key-value')" data-i18n="modal.copy">Copy</button>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="closeModal('generated-key-modal')" data-i18n="modal.saved">I've Saved It</button>
            </div>
        </div>
    </div>

    <!-- Model Routes Configuration Modal -->
    <div id="model-routes-modal" class="modal">
        <div class="modal-content modal-routes">
            <div class="modal-header">
                <div class="modal-title">
                    <h3><span data-i18n="routes.config_title">Model Routes Configuration</span></h3>
                    <p class="modal-subtitle"><span data-i18n="routes.key_name_prefix">API Key:</span> <span id="model-routes-key-name" class="key-name"></span></p>
                </div>
                <span class="close" onclick="closeModal('model-routes-modal')">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="routes-header">
                    <div class="routes-info">
                        <p data-i18n="routes.description">Configure routing rules to redirect specific models to different providers.</p>
                    </div>
                    <button class="btn btn-primary" onclick="app.showAddRouteForm()" data-i18n="routes.add_route">
                        <i class="icon-plus">+</i> Add Route
                    </button>
                </div>
                
                <!-- Model Routes Table -->
                <div class="routes-table-container">
                    <table class="routes-table" id="model-routes-table">
                        <thead>
                            <tr>
                                <th class="col-source" data-i18n="routes.table.source_model">Source Model</th>
                                <th class="col-target" data-i18n="routes.table.target_model">Target Model</th>
                                <th class="col-provider" data-i18n="routes.table.provider">Provider</th>
                                <th class="col-priority" data-i18n="routes.table.priority">Priority</th>
                                <th class="col-status" data-i18n="routes.table.status">Status</th>
                                <th class="col-actions" data-i18n="routes.table.actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="model-routes-tbody">
                            <tr>
                                <td colspan="6" class="empty-state">
                                    <div class="empty-state-content">
                                        <div class="empty-state-icon">ðŸ“‹</div>
                                        <div class="empty-state-text" data-i18n="routes.loading">Loading routes...</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="modal-footer">
                <div class="footer-info">
                    <small data-i18n="routes.auto_save_info">Changes are automatically saved when you add, edit, or delete routes.</small>
                </div>
                <div class="footer-actions">
                    <button type="button" class="btn btn-primary" onclick="closeModal('model-routes-modal')" data-i18n="modal.close">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Route Modal -->
    <div id="route-form-modal" class="modal">
        <div class="modal-content modal-form">
            <div class="modal-header-simple">
                <h3 id="route-form-title" data-i18n="routes.add_route_title">Add Model Route</h3>
                <span class="close" onclick="closeModal('route-form-modal')">&times;</span>
            </div>
            <form id="route-form">
                <div class="form-group">
                    <label for="route-source-model" data-i18n="routes.form.source_model">Source Model:</label>
                    <input type="text" id="route-source-model" placeholder="e.g., gpt-4* or claude-*" data-i18n-placeholder="routes.form.source_placeholder" required>
                    <small data-i18n="routes.form.source_help">Use * for wildcards (e.g., gpt-4* matches all GPT-4 variants)</small>
                </div>
                
                <div class="form-group">
                    <label for="route-target-model" data-i18n="routes.form.target_model">Target Model:</label>
                    <input type="text" id="route-target-model" placeholder="e.g., gpt-4-turbo-preview" data-i18n-placeholder="routes.form.target_placeholder" required>
                </div>
                
                <div class="form-group">
                    <label for="route-target-provider" data-i18n="routes.form.target_provider">Target Provider:</label>
                    <select id="route-target-provider" required>
                        <option value="" data-i18n="routes.form.select_provider">Select Provider</option>
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                        <option value="google">Google</option>
                        <option value="qwen">Qwen</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="route-priority" data-i18n="routes.form.priority">Priority:</label>
                    <input type="number" id="route-priority" value="10" min="0" max="1000" required>
                    <small data-i18n="routes.form.priority_help">Lower numbers = higher priority</small>
                </div>
                
                <div class="form-group">
                    <label for="route-description" data-i18n="routes.form.description">Description:</label>
                    <input type="text" id="route-description" placeholder="Optional description" data-i18n-placeholder="routes.form.description_placeholder">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="route-enabled" checked> <span data-i18n="routes.form.enabled">Enabled</span>
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('route-form-modal')" data-i18n="modal.cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="routes.form.save_route">Save Route</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Global Route Form Modal -->
    <div id="global-route-form-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('global-route-form-modal')">&times;</span>
            <h3 id="global-route-form-title" data-i18n="global_routes.add_route_title">Add Global Route</h3>
            <form id="global-route-form">
                <div class="form-group">
                    <label for="global-route-source-model" data-i18n="routes.form.source_model">Source Model:</label>
                    <input type="text" id="global-route-source-model" placeholder="e.g., gpt-4* or claude-*" data-i18n-placeholder="routes.form.source_placeholder" required>
                    <small data-i18n="routes.form.source_help">Use * for wildcards (e.g., gpt-4* matches all GPT-4 variants)</small>
                </div>
                
                <div class="form-group">
                    <label for="global-route-target-model" data-i18n="routes.form.target_model">Target Model:</label>
                    <input type="text" id="global-route-target-model" placeholder="e.g., gpt-4-turbo-preview" data-i18n-placeholder="routes.form.target_placeholder" required>
                </div>
                
                <div class="form-group">
                    <label for="global-route-target-provider" data-i18n="routes.form.target_provider">Target Provider:</label>
                    <select id="global-route-target-provider" required>
                        <option value="" data-i18n="routes.form.select_provider">Select Provider</option>
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                        <option value="google">Google</option>
                        <option value="qwen">Qwen</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="global-route-priority" data-i18n="routes.form.priority">Priority:</label>
                    <input type="number" id="global-route-priority" value="10" min="0" max="1000" required>
                    <small data-i18n="routes.form.priority_help">Lower numbers = higher priority</small>
                </div>
                
                <div class="form-group">
                    <label for="global-route-description" data-i18n="routes.form.description">Description:</label>
                    <input type="text" id="global-route-description" placeholder="Optional description" data-i18n-placeholder="routes.form.description_placeholder">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="global-route-enabled" checked> <span data-i18n="routes.form.enabled">Enabled</span>
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('global-route-form-modal')" data-i18n="modal.cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="routes.form.save_route">Save Route</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/static/js/i18n.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>