# 架构分层重构计划

## 重构目标

将当前的模块化结构重构为清晰的三层架构：

### 1. 表示层 (Presentation Layer)
- **位置**: `src/presentation/`
- **职责**: 处理HTTP请求响应、路由管理、中间件、输入验证
- **包含模块**:
  - `handlers/` - HTTP请求处理器
  - `middleware/` - 认证、日志、CORS等中间件
  - `routes/` - 路由配置和组织
  - `dto/` - 数据传输对象，用于API输入输出

### 2. 业务逻辑层 (Business Logic Layer)  
- **位置**: `src/business/`
- **职责**: 核心业务逻辑、规则验证、服务编排
- **包含模块**:
  - `services/` - 业务服务实现
  - `domain/` - 领域模型和业务规则
  - `validators/` - 业务规则验证
  - `events/` - 事件处理和发布

### 3. 数据访问层 (Data Access Layer)
- **位置**: `src/infrastructure/`
- **职责**: 数据持久化、外部服务调用、配置管理
- **包含模块**:
  - `database/` - 数据库连接和操作
  - `repositories/` - 数据访问接口实现
  - `external/` - 外部API客户端
  - `config/` - 配置管理

### 4. 共享模块 (Shared/Common)
- **位置**: `src/shared/`
- **职责**: 跨层共享的工具和类型
- **包含模块**:
  - `error/` - 统一错误处理
  - `utils/` - 工具函数
  - `types/` - 共享类型定义
  - `constants/` - 常量定义

## 重构步骤

1. **创建新的目录结构**
2. **定义层间接口和依赖关系**  
3. **迁移现有模块到对应层**
4. **更新导入和依赖关系**
5. **测试验证重构结果**

## 层间依赖规则

- **表示层** 只能依赖 **业务逻辑层** 和 **共享模块**
- **业务逻辑层** 只能依赖 **数据访问层** 和 **共享模块**  
- **数据访问层** 只能依赖 **共享模块**
- **共享模块** 不能依赖其他任何层

这确保了清晰的依赖方向和层级分离。